[string]$VerbosePreferenceOld = $VerbosePreference
$VerbosePreference = 'Continue'
[string]$moduleName = 'xDscUsbIP'
[string]$folderSrc = 'C:\Users\Administrator\GitHub\usbip-automount\client-win\usbip'
[string]$pathSrc = [System.IO.Path]::Combine($folderSrc, $moduleName)
[string]$pathManifest = [System.IO.Directory]::EnumerateFiles($pathSrc, "$($moduleName).psd1")
[hashtable]$manifestTable = Import-PowerShellDataFile -Path $pathManifest
[string[]]$propsToSelect = $manifestTable.Keys
[string]$pathDst = 'C:\Program Files\WindowsPowerShell\Modules'
[string]$pathResult = [System.IO.Path]::Combine($pathDst, $moduleName)
Copy-Item -Path $pathSrc -Destination $pathDst -Container -Force -Recurse -Verbose
Get-Module -Name $moduleName -ListAvailable | Select-Object -Property $propsToSelect | Format-List
Import-Module -Name $moduleName -Force -Verbose
Get-DscResource -Module $moduleName -Verbose
Invoke-UsbIds -Verbose -Destination 'C:\temp\' -Ensure Absent -Method Set
Invoke-UsbIds -Verbose -Destination 'C:\temp\' -Ensure Present -Method Get
Invoke-UsbIds -Verbose -Destination 'C:\temp\' -Ensure Present -Method Set
Invoke-UsbIds -Verbose -Destination 'C:\temp\' -Ensure Present -Method Get
Invoke-UsbIpExe -Destination 'C:\temp\' -Ensure Absent -Method Set
Invoke-UsbIpExe -Destination 'C:\temp\' -Ensure Present -Method Get
Invoke-UsbIpExe -Destination 'C:\temp\' -Ensure Present -Method Set
Invoke-UsbIpExe -Destination 'C:\temp\' -Ensure Present -Method Get
Remove-Module -Name $moduleName -Force -Verbose
Remove-Item -Path $pathResult -Recurse -Force -Verbose
$VerbosePreference = $VerbosePreferenceOld
exit
